# curvature-aware-path-planning

## 第一性原理与逆向工程思维

### 第一性原理

>定义:简单来说,第一性原理就是回到问题的最开始,从最基本的问题出发进行逻辑推理,从下往上思考

```bash
#如何使用第一性原理思考问题:
第一性原理要求我们先思考事情的本质,如果你的回答是因为,,,所以,,,那你大概率停留在表面,深入问题,你需要知道事情的本质是什么
思维模式如下:
- 这个事情是什么?
- 这个事情的需求是?目的是?价值是?
- 这个需求为什么存在,这个需求能否以其他形式满足?
- 这个需求背后是什么支撑着他,是最基本的物理规律,还是坚不可摧的数学定理,亦或者是什么不变的基本属性?
```

### 逆向工程思维

>定义:从产品分析原理,利用原理自己复现,从上往下思考



## 问题

### 三维表面的曲率对于机械臂的覆盖路径规划有没有影响



#### 问题剖析

>- 曲率是什么,覆盖路径规划是什么,机械臂的运动是什么
>- 如果不考虑曲率,将违背哪些基本的自然规律和基本属性
>- 从这些规律出发,曲率的影响是否存在,他影响着哪些方面
>- 曲率需要在哪些情况考虑,哪些情况又可以忽略
>- 基于最基本的原理,如何设计一条满意的轨迹



---



#### 概念定义

- 什么是`曲率`

  >###### 特别声明,本文讨论的是三维的曲面曲率,定义在数学上也不够严谨,仅为了让初学者有较为直观的理解
  >
  >三维曲面的法曲率,就是曲面上一点的法向量,沿着某一切方向上变化快慢的体现,其最大值和最小值为主曲率,可表示该点在任意方向的弯曲特性
  >
  >

- 什么是`覆盖路径规划`

  >在给定的三维目标表面,和指定的末端执行器的情况下,生成一条连续,可行的轨迹,这个轨迹要在满足任务约束和自身约束的情况下,使末端执行器的作用范围有效覆盖到三维表面的每一个地方
  >
  >

- 什么是`机械臂`,`机械臂的运动` ,`机械臂的运动由什么产生` ,`运动约束`

  >- 机械臂:多个刚体连杆由旋转或平移关节连接而成的开链的运动学结构,每个关节有一个自由度,整臂的配置空间由每个关节的关节变量组成,机械臂的状态不是指的哪一个坐标,而是指的当下的每个关节角是多少
  >- 机械臂的运动由什么产生:由电机施加力矩产生,由机器人的动力学方程描述
  >- 运动约束有哪些:运动学约束(关节限位,奇异点),动力学约束(电机施加力矩的极限),环境约束(避障,接触),任务约束(规划时间,路径的精度)
  >- 机械臂的运动:是指在物理驱动和多重约束下,关节配置随着时间变化的连续过程,该过程通过动力学方程来决定末端执行器在笛卡尔空间的位置,姿态和轨迹

  

  

#### 如果不考虑曲率,违背的基本规律

>- ###### 高斯绝妙定理
>
>- ###### 刚体运动学的姿态连续约束
>
>- ###### 关节极限
>
>- ###### 物理交互的接触力建模



###### 规律1

```bash
#高斯绝妙定理
高斯绝妙定理,讲的是对于一个非欧几何,高斯曲率在等距变化下不改变,这直接说明了高斯曲率是一个内蕴量
-高斯曲率,是主曲率的乘积,能反映曲面的弯曲程度
-内蕴量,是只依赖第一基本形式(曲面的长度,角度,面积)完全决定,和曲面自身的几何性质以外的无关
-等距变化,是曲面上任意两点间的所有曲线的长度不变的曲面变换
#这个定理意味着,在等距变化后,高斯曲率不变,即他刻画的内蕴弯曲程度不变
#推论,如果两个曲面想完成无拉伸,无压缩的完美贴合(不撕裂,不褶皱),需要保证曲率一致

```

>###### 违背高斯绝妙定理的原因
>
>当你将三维的曲面投影到二维平面进行均匀覆盖路径规划再投影回三维时,必然会导致曲面上的路径是不均匀的
>
>- 举个很简单的例子:一张纸去包裹一个橘子的时候,必然出现褶皱,而不是完美贴合.这是因为,纸的高斯曲率为0,而橘子的曲率不为0.
>- 同理,二维的均匀覆盖,投影回三维时必然导致畸变,即在高曲率的地方,物理面积变小,路径点变多,在低曲率的地方,物理面积变大,路径点变少,从而导致覆盖不均匀



单位物理面积元


$$
dA = \sqrt{EG - F^2} \, du \, dv
$$
平面时,E=G=1,F=0,曲面时,E=G=1,F!=0



###### 规律2

```bash
#刚体运动学的姿态连续约束
结论:法向变化速度正比于曲率和路径速度(末端沿路径移动的线速度)
即,曲率越大,速度越快,法向转的越猛
```

>###### 违背姿态连续约束的原因
>
>期望的末端执行器的z轴是和表面法向量对齐的
>
>如果不考虑曲率,则在起点和终点间是线性插值或者恒定角速度旋转
>
>但法向量的变化不是线性的,由曲率决定
>
>这就意味着实际上法向量会在短时间内快速变化来跟随表面法线,但假设的是匀速的,这就导致了实际法向量并未对齐表面法线,从而产生一个偏移量,导致规划的姿态无法适应曲面
>
>任务失败



###### 规律3

```bash
#关节极限
```

$$
\|\boldsymbol{\omega}\| \lesssim |\kappa_{\text{max}}| \cdot v
$$

>###### 违背关节极限的原因
>
>曲率越高,法向量转弯越急,速度越快,单位时间需要调整方向的次数变多
>
>两者相乘会导致需要的转速越快
>
>然而在不考虑曲率的情况下,w远小于考虑曲率的情况
>
>导致实际需要的w超过了关节的极限



###### 规律4

```bash
#物理交互的接触式建模
接触力:理想情况下,接触力的方向要沿着表面的法线
力控系统,通过传感器测得真实的力,控制器会拿理想的力进行比较,如果有偏差,则微调
```

>###### 违背物理交互的接触式建模的原因
>
>理想情况下,接触力沿着表面的法线方向
>
>但如果不考虑曲率,可能会导致以下三种后果
>
>后果A,力与法线方向不一致,产生切向力,引发滑移,振动,轨迹漂移
>
>后果B,局部压强失控,在相同力的作用下,高曲率的地方接触面积更小,局部压强更大,容易伤害到动物表面
>
>后果C,力控系统发散或振荡,在错误的方向上不断微调直到停机

$$
\mathbf{F}_{\text{desired}} = F_0 \, \mathbf{N}(p)
$$

力-位耦合(若力不在法线方向会引入侧向力)


$$
\Delta p = K_f \left( F_{\text{des}} - F_{\text{actual}} \right)
$$
几何雅可比和力映射(如果力方向错误会导致力矩错误)
$$
\boldsymbol{\tau} = J^T(\mathbf{q}) \, \mathbf{F}
$$


## 可能的解决方案

### 针对覆盖均匀失衡

>问题根源:参数域均匀采样导致物理面积不均匀
>
>解决方案:凸起处稀疏采样,平坦处密集采样
>
>实现公式如下:
>
>物理面积元
>$$
>% 物理面积元
>dA = \sqrt{EG - F^2} \, du \, dv
>$$
>目标物理面积元
>$$
>\Delta u \, \Delta v = \frac{A_0}{\sqrt{EG - F^2}}
>$$



### 针对工具不垂直

>问题根源:用平面假设或线性插值导致姿态错误
>
>解决方案:每一个点使用真实单位法线构建姿态
>
>构建正交标架
>$$
>% 单位法向量（从参数化导出）
>\mathbf{N} = \frac{\mathbf{r}_u \times \mathbf{r}_v}{\|\mathbf{r}_u \times \mathbf{r}_v\|}
>
>% 工具姿态标架（z 沿法向，x 沿路径切向）
>\begin{aligned}
>\mathbf{z} &= \mathbf{N} \\
>\mathbf{x} &= \frac{\mathbf{t}}{\|\mathbf{t}\|} \quad (\text{路径切向}) \\
>\mathbf{y} &= \mathbf{z} \times \mathbf{x} \\
>R &= \left[ \mathbf{x} \ \mathbf{y} \ \mathbf{z} \right] \in SO(3)
>\end{aligned}
>$$



### 针对关节超限

>问题根源:高速+高曲率导致w变高超过关节限制
>
>解决方案:使用速度u规划限制
>$$
>% 角速度与曲率、速度的关系
>\|\boldsymbol{\omega}\| \approx |\kappa_{\text{max}}| \cdot v
>
>% 动态速度规划（避免超限）
>v(p) = \min\left( v_{\text{nominal}},\ \frac{\omega_{\text{max}}}{|\kappa_{\text{max}}(p)| + \epsilon} \right)
>$$



### 针对压强失控

>问题根源:高曲率的地方接触面积小,局部压强大
>
>解决方案:根据曲率动态调整期望力,维持近似的恒定压强
>
>力补偿策略
>$$
>% 压强与曲率、力的关系（Hertz 简化）
>p \propto F \cdot |\kappa_{\text{max}}|^{2/3}
>
>% 自适应期望力（维持近似恒定压强）
>F_{\text{desired}}(p) = F_0 \cdot \left( \frac{|\kappa_{\text{ref}}|}{|\kappa_{\text{max}}(p)| + \epsilon} \right)^{\alpha}
>$$